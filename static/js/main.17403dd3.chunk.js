(this["webpackJsonpreact_dynamic-list-of-posts"]=this["webpackJsonpreact_dynamic-list-of-posts"]||[]).push([[0],{19:function(e,t,s){},22:function(e,t,s){},23:function(e,t,s){"use strict";s.r(t);var n,a=s(12),c=s.n(a),o=s(5),i=s(4),r=s.n(i),l=s(2),d=s.n(l),m=s(3),u=s.n(m),j=s(6),b=s(1),h=s(0);!function(e){e.setIsUsersLoaded="setIsUsersLoaded",e.setSelectedUser="setSelectedUser",e.setUserPosts="setUserPosts",e.setSelectedPost="setSelectedPost",e.setIsUserPostsLoading="setIsUserPostsLoading",e.setIsUserPostsError="setIsUserPostsError",e.setPostComments="setPostComments",e.setIsPostsCommentsLoading="setIsPostsCommentsLoading",e.setIsPostsCommentsError="setIsPostsCommentsError",e.setIsWriteComment="setIsWriteComment"}(n||(n={}));var O={isUsersLoaded:!1,selectedUser:null,userPosts:null,selectedPost:null,isUserPostsLoading:!1,isUserPostsError:!1,postComments:null,isPostsCommentsLoading:!1,isPostsCommentsError:!1,isWriteComment:!1},p=function(e,t){var s,a=t.type,c=t.payload;switch(a){case n.setIsUsersLoaded:return Object(b.a)(Object(b.a)({},e),{},{isUsersLoaded:c});case n.setSelectedUser:return(null===(s=e.selectedUser)||void 0===s?void 0:s.id)===c.id?Object(b.a)({},e):Object(b.a)(Object(b.a)({},e),{},{selectedUser:c,isUserPostsLoading:!1,isUserPostsError:!1,selectedPost:null,postComments:null});case n.setIsUserPostsLoading:return Object(b.a)(Object(b.a)({},e),{},{isUserPostsLoading:c});case n.setIsUserPostsError:return Object(b.a)(Object(b.a)({},e),{},{isUserPostsError:c});case n.setUserPosts:return Object(b.a)(Object(b.a)({},e),{},{userPosts:c,isUserPostsLoading:!1});case n.setSelectedPost:return Object(b.a)(Object(b.a)({},e),{},{selectedPost:c});case n.setIsPostsCommentsLoading:return Object(b.a)(Object(b.a)({},e),{},{isPostsCommentsLoading:c});case n.setIsPostsCommentsError:return Object(b.a)(Object(b.a)({},e),{},{isPostsCommentsError:c});case n.setPostComments:return Object(b.a)(Object(b.a)({},e),{},{postComments:c});case n.setIsWriteComment:return Object(b.a)(Object(b.a)({},e),{},{isWriteComment:c});default:return e}},x=d.a.createContext((function(){})),y=d.a.createContext(O),f=function(e){var t=e.children,s=Object(l.useReducer)(p,O),n=Object(j.a)(s,2),a=n[0],c=n[1];return Object(h.jsx)(x.Provider,{value:c,children:Object(h.jsx)(y.Provider,{value:a,children:t})})},v=function(){var e=Object(l.useContext)(x),t=Object(l.useContext)(y),s=t.userPosts,a=t.selectedPost;return Object(h.jsxs)("div",{"data-cy":"PostsList",children:[Object(h.jsx)("p",{className:"title",children:"Posts:"}),Object(h.jsxs)("table",{className:"table is-fullwidth is-striped is-hoverable is-narrow",children:[Object(h.jsx)("thead",{children:Object(h.jsxs)("tr",{className:"has-background-link-light",children:[Object(h.jsx)("th",{children:"#"}),Object(h.jsx)("th",{children:"Title"}),Object(h.jsx)("th",{children:" "})]})}),Object(h.jsx)("tbody",{children:s&&s.map((function(t){return Object(h.jsxs)("tr",{"data-cy":"Post",children:[Object(h.jsx)("td",{"data-cy":"PostId",children:t.id}),Object(h.jsx)("td",{"data-cy":"PostTitle",children:t.title}),Object(h.jsx)("td",{className:"has-text-right is-vcentered",children:Object(h.jsx)("button",{type:"button","data-cy":"PostButton",className:u()("button is-link",{"is-light":(null===a||void 0===a?void 0:a.id)!==t.id}),onClick:function(){return function(t){(null===a||void 0===a?void 0:a.id)===t.id?(e({type:n.setSelectedPost,payload:null}),e({type:n.setIsWriteComment,payload:!1})):(e({type:n.setSelectedPost,payload:t}),e({type:n.setIsWriteComment,payload:!1}))}(t)},children:(null===a||void 0===a?void 0:a.id)===t.id?"Close":"Open"})})]},t.id)}))})]})]})},N=(s(19),function(){return Object(h.jsx)("div",{className:"Loader","data-cy":"Loader",children:Object(h.jsx)("div",{className:"Loader__content"})})}),g=s(10),C=s(8),P="https://mate.academy/students-api";function E(e){return new Promise((function(t){setTimeout(t,e)}))}function U(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n={method:t};return s&&(n.body=JSON.stringify(s),n.headers={"Content-Type":"application/json; charset=UTF-8"}),E(300).then((function(){return fetch(P+e,n)})).then((function(e){if(e.ok)return e.json();throw new Error}))}var I=function(e){return U(e)},w=function(e,t){return U(e,"POST",t)},L=function(e){return U(e,"DELETE")},k={name:"",email:"",comment:"",isNameEmpty:!1,isEmailEmpty:!1,isCommentEmpty:!1,isAddingNewComment:!1},S=function(){var e=Object(l.useContext)(x),t=Object(l.useContext)(y),s=t.selectedPost,a=t.postComments,c=(null===s||void 0===s?void 0:s.id)||0,i=Object(l.useState)(k),d=Object(j.a)(i,2),m=d[0],O=d[1],p=function(e,t){var s="is".concat(t.charAt(0).toUpperCase()).concat(t.slice(1),"Empty");O((function(n){var a;return Object(b.a)(Object(b.a)({},n),{},(a={},Object(C.a)(a,t,e),Object(C.a)(a,s,!1),a))}))},f=function(){var t=Object(o.a)(r.a.mark((function t(){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return O((function(e){return Object(b.a)(Object(b.a)({},e),{},{isAddingNewComment:!0})})),t.next=3,w("/comments?postId=".concat(c),{postId:c,name:m.name,email:m.email,body:m.comment}).then((function(t){a&&t.postId&&e({type:n.setPostComments,payload:[].concat(Object(g.a)(a),[t])})})).catch((function(){})).finally((function(){O((function(e){return Object(b.a)(Object(b.a)({},e),{},{comment:"",isAddingNewComment:!1})}))}));case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(h.jsxs)("form",{"data-cy":"NewCommentForm",onSubmit:function(e){return function(e){e.preventDefault();var t=m.name,s=m.email,n=m.comment;t&&s&&n?f():O((function(e){return Object(b.a)(Object(b.a)({},e),{},{isNameEmpty:0===e.name.length,isEmailEmpty:0===e.email.length,isCommentEmpty:0===e.comment.length})}))}(e)},children:[Object(h.jsxs)("div",{className:"field","data-cy":"NameField",children:[Object(h.jsx)("label",{className:"label",htmlFor:"comment-author-name",children:"Author Name"}),Object(h.jsxs)("div",{className:"control has-icons-left has-icons-right",children:[Object(h.jsx)("input",{type:"text",name:"name",id:"comment-author-name",placeholder:"Name Surname",className:u()("input",{"is-danger":m.isNameEmpty}),value:m.name,onChange:function(e){return p(e.target.value,"name")}}),Object(h.jsx)("span",{className:"icon is-small is-left",children:Object(h.jsx)("i",{className:"fas fa-user"})}),m.isNameEmpty&&Object(h.jsx)("span",{className:"icon is-small is-right has-text-danger","data-cy":"ErrorIcon",children:Object(h.jsx)("i",{className:"fas fa-exclamation-triangle"})})]}),m.isNameEmpty&&Object(h.jsx)("p",{className:"help is-danger","data-cy":"ErrorMessage",children:"Name is required"})]}),Object(h.jsxs)("div",{className:"field","data-cy":"EmailField",children:[Object(h.jsx)("label",{className:"label",htmlFor:"comment-author-email",children:"Author Email"}),Object(h.jsxs)("div",{className:"control has-icons-left has-icons-right",children:[Object(h.jsx)("input",{type:"text",name:"email",id:"comment-author-email",placeholder:"email@test.com",className:u()("input",{"is-danger":m.isEmailEmpty}),value:m.email,onChange:function(e){return p(e.target.value,"email")}}),Object(h.jsx)("span",{className:"icon is-small is-left",children:Object(h.jsx)("i",{className:"fas fa-envelope"})}),m.isEmailEmpty&&Object(h.jsx)("span",{className:"icon is-small is-right has-text-danger","data-cy":"ErrorIcon",children:Object(h.jsx)("i",{className:"fas fa-exclamation-triangle"})})]}),m.isEmailEmpty&&Object(h.jsx)("p",{className:"help is-danger","data-cy":"ErrorMessage",children:"Email is required"})]}),Object(h.jsxs)("div",{className:"field","data-cy":"BodyField",children:[Object(h.jsx)("label",{className:"label",htmlFor:"comment-body",children:"Comment Text"}),Object(h.jsx)("div",{className:"control",children:Object(h.jsx)("textarea",{id:"comment-body",name:"body",placeholder:"Type comment here",className:u()("textarea",{"is-danger":m.isCommentEmpty}),value:m.comment,onChange:function(e){return p(e.target.value,"comment")}})}),m.isCommentEmpty&&Object(h.jsx)("p",{className:"help is-danger","data-cy":"ErrorMessage",children:"Enter some text"})]}),Object(h.jsxs)("div",{className:"field is-grouped",children:[Object(h.jsx)("div",{className:"control",children:Object(h.jsx)("button",{type:"submit",className:u()("button is-link",{"is-loading":m.isAddingNewComment}),children:"Add"})}),Object(h.jsx)("div",{className:"control",children:Object(h.jsx)("button",{type:"reset",className:"button is-link is-light",onClick:function(){return O(k)},children:"Clear"})})]})]})},T=function(){var e=Object(l.useContext)(x),t=Object(l.useContext)(y),s=t.selectedPost,a=t.postComments,c=t.isPostsCommentsLoading,i=t.isPostsCommentsError,d=t.isWriteComment,m=function(){var t=Object(o.a)(r.a.mark((function t(){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!s){t.next=4;break}return e({type:n.setIsPostsCommentsLoading,payload:!0}),t.next=4,I("/comments?postId=".concat(s.id)).then((function(t){e({type:n.setPostComments,payload:t})})).catch((function(){return e({type:n.setIsPostsCommentsError,payload:!0})})).finally((function(){return e({type:n.setIsPostsCommentsLoading,payload:!1})}));case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();Object(l.useEffect)((function(){m()}),[s]);return Object(h.jsx)("div",{className:"content","data-cy":"PostDetails",children:Object(h.jsxs)("div",{className:"content","data-cy":"PostDetails",children:[Object(h.jsxs)("div",{className:"block",children:[Object(h.jsx)("h2",{"data-cy":"PostTitle",children:"#".concat(null===s||void 0===s?void 0:s.id,": ").concat(null===s||void 0===s?void 0:s.title)}),Object(h.jsx)("p",{"data-cy":"PostBody",children:null===s||void 0===s?void 0:s.body})]}),Object(h.jsxs)("div",{className:"block",children:[c&&Object(h.jsx)(N,{}),!c&&i&&Object(h.jsx)("div",{className:"notification is-danger","data-cy":"CommentsError",children:"Something went wrong"}),!c&&!i&&0===(null===a||void 0===a?void 0:a.length)&&Object(h.jsx)("p",{className:"title is-4","data-cy":"NoCommentsMessage",children:"No comments yet"}),!c&&0!==(null===a||void 0===a?void 0:a.length)&&Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)("p",{className:"title is-4",children:"Comments:"}),null===a||void 0===a?void 0:a.map((function(t){return Object(h.jsxs)("article",{className:"message is-small","data-cy":"Comment",children:[Object(h.jsxs)("div",{className:"message-header",children:[Object(h.jsx)("a",{href:"mailto:".concat(t.email),"data-cy":"CommentAuthor",children:t.name}),Object(h.jsx)("button",{"data-cy":"CommentDelete",type:"button",className:"delete is-small","aria-label":"delete",onClick:function(){return s=t.id,L("/comments/".concat(s)),void e({type:n.setPostComments,payload:null===a||void 0===a?void 0:a.filter((function(e){return e.id!==s}))});var s},children:"delete button"})]}),Object(h.jsx)("div",{className:"message-body","data-cy":"CommentBody",children:t.body})]},t.id)}))]}),!c&&!i&&!d&&Object(h.jsx)("button",{"data-cy":"WriteCommentButton",type:"button",className:"button is-link",onClick:function(){return e({type:n.setIsWriteComment,payload:!0})},children:"Write a comment"})]}),d&&Object(h.jsx)(S,{})]})})},W=[];I("/users").then((function(e){return W.push.apply(W,Object(g.a)(e))}));var A=function(){var e=Object(l.useContext)(y).selectedUser,t=Object(l.useContext)(x),s=Object(l.useState)(!1),a=Object(j.a)(s,2),c=a[0],o=a[1],i=(null===e||void 0===e?void 0:e.name)||"Choose a user";return Object(h.jsxs)("div",{"data-cy":"UserSelector",className:u()("dropdown",{"is-active":c}),children:[Object(h.jsx)("div",{className:"dropdown-trigger",children:Object(h.jsxs)("button",{type:"button",className:"button","aria-haspopup":"true","aria-controls":"dropdown-menu",onClick:function(){return o(!c)},onBlur:function(){return o(!1)},children:[Object(h.jsx)("span",{children:i}),Object(h.jsx)("span",{className:"icon is-small",children:Object(h.jsx)("i",{className:"fas fa-angle-down","aria-hidden":"true"})})]})}),c&&Object(h.jsx)("div",{className:"dropdown-menu",id:"dropdown-menu",role:"menu",children:Object(h.jsx)("div",{className:"dropdown-content",children:W&&W.map((function(s){return Object(h.jsx)("a",{href:"#user-".concat(s.id),className:u()("dropdown-item",{"is-active":s.id===(null===e||void 0===e?void 0:e.id)}),onMouseDown:function(e){e.preventDefault(),t({type:n.setSelectedUser,payload:s}),o(!1)},children:s.name},s.id)}))})})]})},F=(s(20),s(21),s(22),function(){var e=Object(l.useContext)(x),t=Object(l.useContext)(y),s=t.selectedUser,a=t.userPosts,c=t.selectedPost,i=t.isUserPostsLoading,d=t.isUserPostsError,m=function(){var t=Object(o.a)(r.a.mark((function t(){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!s){t.next=4;break}return e({type:n.setIsUserPostsLoading,payload:!0}),t.next=4,I("/posts?userId=".concat(s.id)).then((function(t){e({type:n.setUserPosts,payload:t})})).catch((function(){return e({type:n.setIsUserPostsError,payload:!0})})).finally((function(){return e({type:n.setIsUserPostsLoading,payload:!1})}));case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(l.useEffect)((function(){m()}),[s]),Object(h.jsx)("main",{className:"section",children:Object(h.jsx)("div",{className:"container",children:Object(h.jsxs)("div",{className:"tile is-ancestor",children:[Object(h.jsx)("div",{className:"tile is-parent",children:Object(h.jsxs)("div",{className:"tile is-child box is-success",children:[Object(h.jsx)("div",{className:"block",children:Object(h.jsx)(A,{})}),Object(h.jsxs)("div",{className:"block","data-cy":"MainContent",children:[null===s&&Object(h.jsx)("p",{"data-cy":"NoSelectedUser",children:"No user selected"}),i&&Object(h.jsx)(N,{}),d&&Object(h.jsx)("div",{className:"notification is-danger","data-cy":"PostsLoadingError",children:"Something went wrong!"}),!i&&!d&&s&&0===(null===a||void 0===a?void 0:a.length)&&Object(h.jsx)("div",{className:"notification is-warning","data-cy":"NoPostsYet",children:"No posts yet"}),!i&&!d&&s&&0!==(null===a||void 0===a?void 0:a.length)&&Object(h.jsx)(v,{})]})]})}),Object(h.jsx)("div",{"data-cy":"Sidebar",className:u()("tile","is-parent","is-8-desktop","Sidebar",{"Sidebar--open":c}),children:Object(h.jsx)("div",{className:"tile is-child box is-success ",children:c&&Object(h.jsx)(T,{})})})]})})})});c.a.render(Object(h.jsx)(f,{children:Object(h.jsx)(F,{})}),document.getElementById("root"))}},[[23,1,2]]]);
//# sourceMappingURL=main.17403dd3.chunk.js.map